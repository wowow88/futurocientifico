name: Render TikTok Video

on:
  workflow_dispatch:
    inputs:
      image_url:
        description: "public/avatar-cientifico.png"
        required: true
      out_name:
        description: "Nombre del archivo de salida"
        required: true
        default: "futurocientifico.mp4"
      text1:
        description: "Texto 1 (branding)"
        required: true
        default: "FuturoCient√≠fico üöÄ Ciencia en 1 minuto"
      text2:
        description: "Texto 2 (titulo)"
        required: true
      text3:
        description: "Texto 3 (hashtags)"
        required: true
        default: "#Ciencia #Curiosidades #FuturoCient√≠fico"
      text4:
        description: "Texto 4 (redes)"
        required: true
        default: "IG: @futurocientifico2025 ‚Ä¢ TikTok: @futurocientifico ‚Ä¢ X: @futuro100tico ‚Ä¢ YouTube: @futurocientifico"
      music_url:
        description: "URL de m√∫sica (opcional)"
        required: false
        default: ""
      duration:
        description: "Duraci√≥n en segundos"
        required: true
        default: "15"

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Ensure ffmpeg
        run: |
          ffmpeg -version || (sudo apt-get update && sudo apt-get install -y ffmpeg)

      - name: Render with FFmpeg
        run: |
          bash scripts/render.sh \
            "${{ github.event.inputs.image_url }}" \
            "${{ github.event.inputs.out_name }}" \
            "${{ github.event.inputs.text1 }}" \
            "${{ github.event.inputs.text2 }}" \
            "${{ github.event.inputs.text3 }}" \
            "${{ github.event.inputs.text4 }}" \
            "${{ github.event.inputs.music_url }}" \
            "${{ github.event.inputs.duration }}"

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: video
          path: ${{ github.workspace }}/${{ github.event.inputs.out_name }}

      # (Opcional) Publicar en un Release para URL p√∫blica directa
      - name: Create Release
        if: always()
        uses: softprops/action-gh-release@v2
        with:
          tag_name: auto-video-${{ github.run_id }}
          name: Auto Video ${{ github.run_id }}
          draft: false
          prerelease: false
          files: ${{ github.workspace }}/${{ github.event.inputs.out_name }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
