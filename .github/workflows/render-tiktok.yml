  eduflash:
    name: "EduFlash: JSON diario"
    needs: articles
    runs-on: ubuntu-latest
    steps:
      - name: "Checkout FuturoCient√≠fico (repo actual)"
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          path: futurocientifico

      # ‚¨áÔ∏è Nuevo: sincroniza la rama local con origin/main ANTES de trabajar
      - name: "Sync con origin/main"
        working-directory: futurocientifico
        run: |
          set -euo pipefail
          git fetch origin main
          # Nos aseguramos de estar en main y rebasamos (sin merges)
          git checkout main
          git pull --rebase origin main

      - name: "Setup Python 3.11"
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: "Instalar dependencias Python"
        working-directory: futurocientifico
        run: |
          python -m pip install --upgrade pip
          pip install feedparser beautifulsoup4 requests

      - name: "Ejecutar EduFlash"
        working-directory: futurocientifico
        run: |
          set -euo pipefail
          test -f scripts/eduflash_pipeline.py || (echo "‚ùå Falta scripts/eduflash_pipeline.py" && exit 1)
          python scripts/eduflash_pipeline.py

      # ‚¨áÔ∏è Opcional: re-verificamos por si la rama avanz√≥ durante el script
      - name: "Rebase r√°pido pre-push"
        working-directory: futurocientifico
        run: |
          set -euo pipefail
          git fetch origin main
          git pull --rebase origin main

      - name: "Commit y push de EduFlash"
        working-directory: futurocientifico
        run: |
          set -euo pipefail
          git config user.name  "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add public/eduflash.json
          git commit -m "üìö EduFlash actualizado autom√°ticamente [skip ci]" || echo "No changes"
          git push
