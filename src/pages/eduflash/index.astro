---
import Layout from '../../layouts/Layout.astro';
import Seo from '../../components/Seo.astro';
import RSS from '@astrojs/rss';

const feeds = [
  { name: 'And. Educación – Consejería', url: 'https://www.juntadeandalucia.es/educacion/portals/suscripciones-rss/consejeria-noticias.xml' },
  { name: 'And. Educación – Alumnado', url: 'https://www.juntadeandalucia.es/educacion/portals/suscripciones-rss/alumnado-novedades.xml' },
  { name: 'And. Educación – Profesorado', url: 'https://www.juntadeandalucia.es/educacion/portals/suscripciones-rss/profesorado-novedades.xml' },
  { name: 'Xunta Galicia Educación', url: 'https://www.edu.xunta.gal/portal/rss' },
  { name: 'Biblioteca Aragón', url: 'https://bibliotecavirtual.aragon.es/portal/rss.do' }
];

const allItems = await Promise.all(
  feeds.map(async feed => {
    const res = await fetch(feed.url);
    const xml = await res.text();
    const items = await RSS.parseItems(xml);
    return items.map(i => ({ ...i, source: feed.name }));
  })
).then(arrays => arrays.flat());

allItems.sort((a, b) => new Date(b.pubDate) - new Date(a.pubDate));
const items = allItems.slice(0, 30);
---

<Seo 
  title="EduFlash | Noticias educativas oficiales"
  description="Noticias recientes desde fuentes educativas oficiales de comunidades autónomas: Andalucía, Galicia, Aragón."
  site="https://futurocientifico.vercel.app/eduflash"
/>

<Layout>
  <section class="bg-blue-50 p-6 rounded-xl shadow-sm text-center mb-8">
    <h1 class="text-3xl font-bold text-blue-800">EduFlash</h1>
    <p class="mt-2 text-blue-700 text-sm max-w-xl mx-auto">
      Últimas noticias extraídas automáticamente de fuentes educativas oficiales autonómicas.
    </p>
  </section>

  <ul role="list" class="space-y-6 px-4 max-w-3xl mx-auto">
    {items.map(item => (
      <li key={item.link} class="bg-white rounded-xl p-4 shadow">
        <a href={item.link} target="_blank" rel="noopener noreferrer" class="text-lg font-semibold text-blue-700 hover:underline">
          {item.title}
        </a>
        <time datetime={new Date(item.pubDate).toISOString()} class="block text-sm text-gray-500 mt-1">
          {new Date(item.pubDate).toLocaleDateString('es-ES')} – {item.source}
        </time>
      </li>
    ))}
  </ul>
</Layout>
