---
import InlineSearch from "../components/InlineSearch.astro";
const canonical = Astro.url?.href ?? "https://futurocientifico.es";
const disableTracking = import.meta.env.PUBLIC_DISABLE_TRACKING === 'true';
---
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <title>FuturoCient√≠fico</title>
    <link rel="canonical" href={canonical} />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="FuturoCient√≠fico - Divulgaci√≥n cient√≠fica para todas las edades." />
    <meta name="author" content="FuturoCient√≠fico" />
    <meta name="robots" content="index, follow" />

    <!-- Open Graph -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="FuturoCient√≠fico" />
    <meta property="og:description" content="Divulgaci√≥n cient√≠fica para todas las edades." />
    <meta property="og:image" content="https://futurocientifico.es/avatar-cientifico.webp" />
    <meta property="og:url" content="https://futurocientifico.es" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />

    <!-- Slot para metas por p√°gina -->
    <slot name="head" />

    <!-- Preconnect (solo si no desactivamos tracking en CI) -->
    {!disableTracking && (
      <>
        <link rel="preconnect" href="https://www.google-analytics.com" crossorigin>
        <link rel="preconnect" href="https://pagead2.googlesyndication.com" crossorigin>
      </>
    )}

    <!-- Splash -->
    <style>
      #splash { position: fixed; inset: 0; background: white; display: flex; justify-content: center; align-items: center; z-index: 1000; }
      #splash img { width: 120px; animation: bounce 1s infinite; }
      @keyframes bounce { 0%,100%{ transform: translateY(0);} 50%{ transform: translateY(-10px);} }
    </style>

    <!-- Ads/Analytics solo si no est√° desactivado (p. ej., en CI) -->
    {!disableTracking && (
      <>
        <!-- Ads (√∫nico) -->
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2163450732409344" crossorigin="anonymous"></script>

        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-CB9XQMQ9WY"></script>
        <script>
          {`
            window.dataLayer = window.dataLayer || [];
            function gtag(){ dataLayer.push(arguments); }
            gtag('js', new Date());
            gtag('config', 'G-CB9XQMQ9WY');
          `}
        </script>
      </>
    )}

    <!-- PWA -->
    <link rel="manifest" href="/manifest.webmanifest" />
    <meta name="theme-color" content="#1e3a8a" />
    <link rel="apple-touch-icon" href="/icons/icon-192.png" />

    {!disableTracking && (
      <script>
        {`
          if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
              navigator.serviceWorker.register('/sw.js');
            });
          }
        `}
      </script>
    )}

    <!-- Cookie Consent -->
    <script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" defer></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css" />
    <script>
      window.addEventListener("load", function(){
        window.cookieconsent.initialise({
          palette: { popup: { background: "#1e3a8a" }, button: { background: "#ffffff", text: "#1e3a8a" } },
          theme: "classic",
          position: "bottom-right",
          content: {
            message: "Usamos cookies para mejorar tu experiencia en FuturoCient√≠fico.",
            dismiss: "Aceptar",
            link: "M√°s info",
            href: "/legal/cookies"
          }
        })
      });
    </script>
  </head>

  <body class="relative min-h-screen text-white overflow-x-hidden">
  <img src="/bg-cientifico.webp" alt="" aria-hidden="true"
       class="fixed inset-0 w-full h-full object-cover z-[-1] opacity-30 pointer-events-none select-none" />
    <a href="#contenido" class="sr-only focus:not-sr-only focus:absolute focus:top-2 focus:left-2 bg-blue-900 text-white px-3 py-1 rounded">
      Saltar al contenido
    </a>

    <header class="bg-white border-b sticky top-0 z-50" role="banner">
      <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
        <!-- Logo -->
        <a href="/" class="flex items-center space-x-2">
          <span class="font-bold text-lg text-blue-900">FuturoCient√≠fico</span>
        </a>

        <!-- √çconos sociales -->
        <div class="flex items-center space-x-3">
          <a href="https://www.instagram.com/futurocientifico2025" aria-label="Instagram" title="Instagram">
            <svg class="w-6 h-6 text-blue-900 hover:text-blue-700" fill="currentColor" viewBox="0 0 24 24"><path d="M7.75 2h8.5A5.75 5.75 0 0 1 22 7.75v8.5A5.75 5.75 0 0 1 16.25 22h-8.5A5.75 5.75 0 0 1 2 16.25v-8.5A5.75 5.75 0 0 1 7.75 2Zm0 1.5A4.25 4.25 0 0 0 3.5 7.75v8.5A4.25 4.25 0 0 0 7.75 20.5h8.5A4.25 4.25 0 0 0 20.5 16.25v-8.5A4.25 4.25 0 0 0 16.25 3.5h-8.5ZM12 7a5 5 0 1 1 0 10a5 5 0 0 1 0-10Zm0 1.5a3.5 3.5 0 1 0 0 7a3.5 3.5 0 0 0 0-7Zm5.25-.88a.88.88 0 1 1 0 1.75a.88.88 0 0 1 0-1.75Z"/></svg>
          </a>
          <a href="https://www.tiktok.com/@futurocientifico" aria-label="TikTok" title="TikTok">
            <svg class="w-6 h-6 text-blue-900 hover:text-blue-700" fill="currentColor" viewBox="0 0 24 24"><path d="M12.646 2h3.29c.101 1.214.548 2.122 1.344 2.72c.663.495 1.47.771 2.42.828V9.13c-1.06-.02-2.057-.22-2.99-.6v5.38c0 1.56-.536 2.847-1.61 3.86c-1.05.99-2.327 1.485-3.83 1.485c-1.516 0-2.773-.502-3.77-1.506c-1.01-1.03-1.515-2.316-1.515-3.86c0-1.562.512-2.857 1.535-3.88c1.002-.998 2.248-1.497 3.74-1.497c.678 0 1.31.14 1.896.42v3.338a2.65 2.65 0 0 0-1.34-.345c-.652 0-1.197.232-1.635.696c-.438.455-.657 1.02-.657 1.694c0 .684.217 1.26.65 1.73c.45.486 1.012.73 1.685.73c.658 0 1.213-.24 1.665-.72c.452-.478.678-1.077.678-1.798V2Z"/></svg>
          </a>
          <a href="https://www.youtube.com/@futurocientifico" aria-label="YouTube" title="YouTube">
            <svg class="w-6 h-6 text-blue-900 hover:text-blue-700" fill="currentColor" viewBox="0 0 24 24"><path d="M19.635 3.035C21.116 3.273 22.227 4.385 22.465 5.865c.273 1.607.273 4.957.273 4.957s0 3.35-.273 4.957c-.238 1.48-1.35 2.592-2.83 2.83C17.85 19.5 12 19.5 12 19.5s-5.85 0-7.635-.273C2.884 19.1 1.773 17.988 1.535 16.508 1.262 14.9 1.262 11.55 1.262 11.55s0-3.35.273-4.957C1.773 5.113 2.884 4.002 4.365 3.764 6.15 3.5 12 3.5 12 3.5s5.85 0 7.635.273ZM9.75 8.75v5.5l4.75-2.75-4.75-2.75Z"/></svg>
          </a>
          <a href="https://x.com/Futuro100tfco" aria-label="X (Twitter)" title="X">
            <svg class="w-6 h-6 text-blue-900 hover:text-blue-700" fill="currentColor" viewBox="0 0 24 24"><path d="M20.944 3H18.6l-4.05 5.25-3.43-5.25H2.325L9.6 13.95 3.36 21h2.343l4.354-5.655 3.7 5.655H21.6l-7.692-10.665L20.944 3Z"/></svg>
          </a>

          <!-- Buy Me a Coffee -->
          <a href="https://buymeacoffee.com/futurociene" aria-label="Buy Me a Coffee" title="Buy Me a Coffee">
            <img src="/buymeacoffee.svg" alt="Buy Me a Coffee" class="h-6" />
          </a>
        </div>

        <!-- Navegaci√≥n (escritorio) -->
        <nav class="hidden md:flex space-x-4" role="navigation" aria-label="Navegaci√≥n principal">
          <a href="/formacion" class="text-base text-blue-900 hover:underline">Formaci√≥n</a>
          <a href="/recursos" class="text-base text-blue-900 hover:underline">Recursos</a>
          <a href="/eduflash" class="text-base text-blue-900 hover:underline">Eduflash</a>
          <a href="/revistas" class="text-base text-blue-900 hover:underline">Revistas</a>
          <a href="/preguntona" class="text-base text-blue-900 hover:underline">Preguntona</a>
          <a href="/apoya" class="text-base text-blue-900 hover:underline">Ap√≥yanos</a>
          <a href="/quienes-somos" class="text-base text-blue-900 hover:underline">Qui√©nes Somos</a>
        </nav>

        <!-- Bot√≥n hamburguesa (m√≥vil) -->
        <div class="md:hidden">
          <button id="menu-toggle" aria-label="Abrir men√∫">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
            </svg>
          </button>
        </div>
      </div>
  <div class="max-w-7xl mx-auto px-4 pb-3">
    <InlineSearch placeholder="Buscar en Revistas‚Ä¶" maxResults={0} />
  </div>

      <!-- Men√∫ m√≥vil -->
      <div id="mobile-menu" class="hidden md:hidden px-4 pb-4" role="navigation" aria-label="Navegaci√≥n m√≥vil">
        <a href="/formacion" class="block py-1 text-blue-900">Formaci√≥n</a>
        <a href="/recursos" class="block py-1 text-blue-900">Recursos</a>
        <a href="/eduflash" class="block py-1 text-blue-900">Eduflash</a>
        <a href="/revistas" class="block py-1 text-blue-900">Revistas</a>
        <a href="/preguntona" class="block py-1 text-blue-900">Preguntona</a>
        <a href="/apoya" class="block py-1 text-blue-900">Ap√≥yanos</a>
        <a href="/quienes-somos" class="block py-1 text-blue-900">Qui√©nes Somos</a>
      </div>
    </header>
    <!-- Fondo de cabecera global -->
<section class="relative overflow-hidden bg-[url('/eduflash-header.webp')] bg-cover bg-center bg-no-repeat">
  <div class="absolute inset-0 bg-gradient-to-r from-blue-900/70 to-transparent"></div>
</section>

    <main id="contenido" class="max-w-7xl mx-auto px-4 py-8 min-h-[60vh] flex flex-col md:flex-row gap-4" role="main">
      <!-- Anuncio lateral izquierdo (escritorio) -->
      {!disableTracking && (
        <aside class="w-full md:w-1/6">
          <ins class="adsbygoogle"
            style="display:block"
            data-ad-client="ca-pub-2163450732409344"
            data-ad-slot="6134548917"
            data-ad-format="auto"
            data-full-width-responsive="true"></ins>
          <script>
            if (typeof window !== "undefined") {
              if (window.adsbygoogle && Array.isArray(window.adsbygoogle)) {
                window.adsbygoogle.push({});
              } else {
                const interval = setInterval(() => {
                  if (window.adsbygoogle && Array.isArray(window.adsbygoogle)) {
                    window.adsbygoogle.push({});
                    clearInterval(interval);
                  }
                }, 300);
              }
            }
          </script>
        </aside>
      )}

      <!-- Contenido principal -->
      <div class="flex-1 order-first md:order-none">
        <slot />


    <!-- FOOTER: m√≥vil 2 columnas (izq: contacto | dcha: enlaces + s√≠guenos), escritorio 3 columnas -->
    <footer class="bg-gray-100 text-base text-gray-700 px-4 py-12 mt-12" role="contentinfo">
      <div class="max-w-7xl mx-auto grid grid-cols-2 md:grid-cols-3 gap-6">
        <!-- Columna 1: Contacto (siempre izquierda en m√≥vil y primera en escritorio) -->
        <div class="col-span-1 col-start-1">
          <h3 class="font-semibold text-blue-900 mb-2">FuturoCient√≠fico</h3>
          <p>Divulgaci√≥n cient√≠fica para todas las edades.</p>
          <p class="mt-2">
            Contacto:
            <a href="mailto:futurocientifico2025@gmail.com" class="text-blue-900 hover:underline">futurocientifico2025@gmail.com</a>
          </p>
          <div class="mt-4 text-sm text-gray-600 flex flex-wrap items-center gap-4">
            <a href="/legal/aviso-legal" class="hover:underline">Aviso Legal</a>
            <a href="/legal/privacidad" class="hover:underline">Privacidad</a>
            <a href="/legal/cookies" class="hover:underline">Cookies</a>
            <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.es" target="_blank" rel="noopener noreferrer">
              <img src="https://licensebuttons.net/l/by-nc-sa/4.0/88x31.png" alt="Licencia Creative Commons BY-NC-SA 4.0" class="h-5 inline" loading="lazy" />
            </a>
          </div>
        </div>

        <!-- Columna 2 (m√≥vil): Enlaces -->
        <div class="col-span-1 col-start-2 md:col-start-auto">
          <h4 class="font-semibold text-blue-900 mb-2">Enlaces</h4>
          <ul class="space-y-1">
            <li><a href="/formacion" class="hover:underline">Formaci√≥n</a></li>
            <li><a href="/recursos" class="hover:underline">Recursos</a></li>
            <li><a href="/eduflash" class="hover:underline">Eduflash</a></li>
            <li><a href="/revistas" class="hover:underline">Revistas</a></li>
            <li><a href="/preguntona" class="hover:underline">Preguntona</a></li>
            <li><a href="/apoya" class="hover:underline">Ap√≥yanos</a></li>
            <li><a href="/quienes-somos" class="hover:underline">Qui√©nes Somos</a></li>
          </ul>
        </div>

        <!-- Columna 2 (m√≥vil, debajo de Enlaces en la misma columna) | Columna 3 (escritorio): S√≠guenos -->
        <div class="col-span-1 col-start-2 md:col-start-auto">
          <h4 class="font-semibold text-blue-900 mb-2">S√≠guenos</h4>
          <a href="https://www.instagram.com/futurocientifico2025" class="text-blue-900 hover:underline block" title="Instagram">
            <svg class="w-6 h-6 inline mr-1" fill="currentColor" viewBox="0 0 24 24"><path d="M7.75 2h8.5A5.75 5.75 0 0 1 22 7.75v8.5A5.75 5.75 0 0 1 16.25 22h-8.5A5.75 5.75 0 0 1 2 16.25v-8.5A5.75 5.75 0 0 1 7.75 2Zm0 1.5A4.25 4.25 0 0 0 3.5 7.75v8.5A4.25 4.25 0 0 0 7.75 20.5h8.5A4.25 4.25 0 0 0 20.5 16.25v-8.5A4.25 4.25 0 0 0 16.25 3.5h-8.5ZM12 7a5 5 0 1 1 0 10a5 5 0 0 1 0-10Zm0 1.5a3.5 3.5 0 1 0 0 7a3.5 3.5 0 0 0 0-7Zm5.25-.88a.88.88 0 1 1 0 1.75a.88.88 0 0 1 0-1.75Z"/></svg>
            Instagram
          </a>
          <a href="https://www.tiktok.com/@futurocientifico" class="text-blue-900 hover:underline block mt-2" title="TikTok">
            <svg class="w-6 h-6 inline mr-1" fill="currentColor" viewBox="0 0 24 24"><path d="M12.646 2h3.29c.101 1.214.548 2.122 1.344 2.72c.663.495 1.47.771 2.42.828V9.13c-1.06-.02-2.057-.22-2.99-.6v5.38c0 1.56-.536 2.847-1.61 3.86c-1.05.99-2.327 1.485-3.83 1.485c-1.516 0-2.773-.502-3.77-1.506c-1.01-1.03-1.515-2.316-1.515-3.86c0-1.562.512-2.857 1.535-3.88c1.002-.998 2.248-1.497 3.74-1.497c.678 0 1.31.14 1.896.42v3.338a2.65 2.65 0 0 0-1.34-.345c-.652 0-1.197.232-1.635.696c-.438.455-.657 1.02-.657 1.694c0 .684.217 1.26.65 1.73c.45.486 1.012.73 1.685.73c.658 0 1.213-.24 1.665-.72c.452-.478.678-1.077.678-1.798V2Z"/></svg>
            TikTok
          </a>
          <a href="https://www.youtube.com/@futurocientifico" class="text-blue-900 hover:underline block" title="YouTube">
            <svg class="w-6 h-6 inline mr-1" fill="currentColor" viewBox="0 0 24 24"><path d="M19.635 3.035C21.116 3.273 22.227 4.385 22.465 5.865c.273 1.607.273 4.957.273 4.957s0 3.35-.273 4.957c-.238 1.48-1.35 2.592-2.83 2.83C17.85 19.5 12 19.5 12 19.5s-5.85 0-7.635-.273C2.884 19.1 1.773 17.988 1.535 16.508 1.262 14.9 1.262 11.55 1.262 11.55s0-3.35.273-4.957C1.773 5.113 2.884 4.002 4.365 3.764 6.15 3.5 12 3.5 12 3.5s5.85 0 7.635.273ZM9.75 8.75v5.5l4.75-2.75-4.75-2.75Z"/></svg>
            YouTube
          </a>
          <a href="https://x.com/Futuro100tfco" class="text-blue-900 hover:underline block" title="X">
            <svg class="w-6 h-6 inline mr-1" fill="currentColor" viewBox="0 0 24 24"><path d="M20.944 3H18.6l-4.05 5.25-3.43-5.25H2.325L9.6 13.95 3.36 21h2.343l4.354-5.655 3.7 5.655H21.6l-7.692-10.665L20.944 3Z"/></svg>
            X
          </a>

          <a href="https://buymeacoffee.com/futurociene" title="Inv√≠tanos a un caf√©" class="inline-block mt-2">
            <img src="/buymeacoffee.svg" alt="Buy Me a Coffee" class="h-8" />
          </a>
        </div>
      </div>
    </footer>

    <!-- Barra inferior m√≥vil -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white shadow-inner md:hidden flex justify-around py-2 border-t z-50" role="navigation" aria-label="Navegaci√≥n inferior">
      <a href="/formacion" class="text-blue-900 text-xs text-center"><div>üìò</div><div>Formaci√≥n</div></a>
      <a href="/recursos" class="text-blue-900 text-xs text-center"><div>üß∞</div><div>Recursos</div></a>
      <a href="/eduflash" class="text-blue-900 text-xs text-center"><div>‚ö°</div><div>Eduflash</div></a>
      <a href="/revistas" class="text-blue-900 text-xs text-center"><div>üìö</div><div>Revistas</div></a>
      <a href="/preguntona" class="text-blue-900 text-xs text-center"><div>‚ùì</div><div>Preguntona</div></a>
      <a href="/apoya" class="text-blue-900 text-xs text-center"><div>üíñ</div><div>Apoya</div></a>
    </nav>

    <!-- Scripts de UI -->
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        setTimeout(() => document.getElementById('splash')?.remove(), 1500);

        const toggle = document.getElementById('menu-toggle');
        const menu = document.getElementById('mobile-menu');
        toggle?.addEventListener('click', () => {
          menu?.classList.toggle('hidden');
        });
      });
    </script>
<script is:inline>
  (() => {
    const JSON_URL = "/articles_enriched.json";
    let cache = null;

    const normalize = (s) =>
      (s ?? "")
        .toString()
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "")
        .toLowerCase()
        .trim();

    const escapeHtml = (str) =>
      (str ?? "")
        .toString()
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");

    async function loadData(setStatus) {
      if (cache) return cache;
      setStatus("Cargando art√≠culos‚Ä¶");
      try {
        const res = await fetch(JSON_URL, { cache: "no-store" });
        if (!res.ok) throw new Error("HTTP " + res.status);
        const json = await res.json();
        cache = Array.isArray(json) ? json : [];
      } catch {
        cache = [];
        setStatus("No se pudo cargar el JSON.");
      }
      return cache;
    }

    function init(root) {
      const input = root.querySelector(".fc-search-input");
      const panel = root.querySelector(".fc-search-panel");
      const status = root.querySelector(".fc-search-status");
      const resultsEl = root.querySelector(".fc-search-results");
      const rawMax = parseInt(root.getAttribute("data-max-results") || "0", 10);
      const max = Number.isFinite(rawMax) && rawMax > 0 ? rawMax : Infinity;

      if (!input || !panel || !status || !resultsEl) return;

      const open = () => panel.classList.remove("hidden");
      const close = () => panel.classList.add("hidden");
      const setStatus = (t) => (status.textContent = t);

    function score(item, queryRaw, sourcesNorm) {
      const tokens = normalize(queryRaw).split(/\s+/).filter(Boolean);
      if (!tokens.length) return -1;

  // Detectar si alguna palabra parece una FUENTE (arxiv, nasa, nature...)
      let sourceToken = null;

  // Prioriza coincidencia exacta; si no, contiene
      for (const t of tokens) {
    const exact = sourcesNorm.find(s => s === t);
      if (exact) { sourceToken = exact; break; }
    }
  if (!sourceToken) {
    for (const t of tokens) {
      const partial = sourcesNorm.find(s => s.includes(t) || t.includes(s));
      if (partial) { sourceToken = partial; break; }
    }
  }

  const titleTokens = sourceToken ? tokens.filter(t => t !== sourceToken) : tokens;

  const title = normalize(item?.title_es ?? "");
  const source = normalize(item?.source ?? "");

  // Reglas:
  // - si hay sourceToken: source debe coincidir
  // - si hay titleTokens: TODOS deben estar en el t√≠tulo
  const okSource = sourceToken ? source.includes(sourceToken) : true;
  const okTitle = titleTokens.length ? titleTokens.every(t => title.includes(t)) : true;

  if (!okSource || !okTitle) return -1;

  // Scoring simple: t√≠tulo pesa m√°s, y fuente suma si se us√≥
  let sc = 0;

  if (sourceToken) sc += 120;
  if (titleTokens.length) sc += 200;

  // Bonus por aparecer pronto en el t√≠tulo
  if (titleTokens.length) {
    const firstPos = Math.min(...titleTokens.map(t => title.indexOf(t)).filter(i => i >= 0));
    sc += Math.max(0, 120 - firstPos);
  }

  return sc;
}


      function render(items, qRaw) {
        resultsEl.innerHTML = "";

        if (!qRaw) {
          setStatus("Escribe para buscar.");
          return;
        }
        if (!items.length) {
          setStatus(`Sin resultados para ‚Äú${qRaw}‚Äù.`);
          return;
        }

        setStatus(`${items.length} resultado(s) para ‚Äú${qRaw}‚Äù.`);

        const shown = Number.isFinite(max) ? items.slice(0, max) : items;
        const html = shown.map((item) => {
          const title = escapeHtml(item?.title_es ?? "T√≠tulo");
          const source = escapeHtml(item?.source ?? "Fuente");
          const date = item?.date ? new Date(item.date).toLocaleDateString() : "";
          const href = item?.url || "#";

          return `
            <a class="block px-4 py-3 hover:bg-purple-50 focus:bg-purple-50 outline-none"
               href="${href}" target="_blank" rel="noopener noreferrer" role="option">
              <div class="text-sm font-semibold text-purple-900">${title}</div>
              <div class="text-xs text-gray-600">${source}${date ? ` | ${date}` : ""}</div>
            </a>
          `;
        }).join("");

        resultsEl.insertAdjacentHTML("beforeend", html);
      }

      async function run() {
        const qRaw = input.value.trim();
        const q = normalize(qRaw);
        open();

        if (!q) {
          resultsEl.innerHTML = "";
          setStatus("Escribe para buscar.");
          return;
        }

        const list = await loadData(setStatus);

        // Normalizamos las fuentes disponibles 1 vez por b√∫squeda
        const sourcesNorm = Array.from(
        new Set(list.map(a => a?.source).filter(Boolean).map(s => normalize(s)))
        );

        const scored = list
          .map((item) => ({ item, sc: score(item, qRaw, sourcesNorm) }))
          .filter((x) => x.sc >= 0)
          .sort((a, b) => b.sc - a.sc)
          .map((x) => x.item);
        render(scored, qRaw);
      }

      let t = null;
      const debounced = () => {
        clearTimeout(t);
        t = setTimeout(run, 150);
      };

      input.addEventListener("focus", () => {
        open();
        if (!input.value.trim()) setStatus("Escribe para buscar.");
      });

      input.addEventListener("input", debounced);

      input.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          run();
        }
        if (e.key === "Escape") close();
      });

      document.addEventListener("click", (e) => {
        if (!root.contains(e.target)) close();
      });
    }

    document.querySelectorAll(".fc-search-root").forEach(init);
  })();
</script>


  </body>
</html>
